steps:
  - name: Checkout
    uses: actions/checkout@v4

  - name: Setup Python
    uses: actions/setup-python@v4
    with:
      python-version: ${{ matrix.python-version }}
      cache: 'pip'

  - name: Upgrade pip and build tools
    run: |
      python -m pip install --upgrade pip setuptools wheel

  - name: Install Python dependencies
    if: exists('requirements.txt')
    run: |
      pip install -r requirements.txt

  # Optional: prefer binary wheels for pyzstd when available (keeps pip from falling back to source build on platforms without wheels)
  - name: Install pyzstd (prefer binary)
    run: |
      pip install --prefer-binary pyzstd || true

  # Platform-specific setup for building the native Qt/C++ project
  - name: Setup build environment (Windows)
    if: runner.os == 'Windows'
    run: |
      choco install -y qt5-runtime visualstudio2019-workload-vctools
    shell: bash

  - name: Setup build environment (Linux)
    if: runner.os == 'Linux'
    run: |
      sudo apt-get update
      sudo apt-get install -y build-essential qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools
    shell: bash

  - name: Setup build environment (macOS)
    if: runner.os == 'macOS'
    run: |
      brew update
      brew install qt@5
    shell: bash

  - name: Configure & build
    run: |
      mkdir -p build
      cd build
      # adjust the build commands below to match your project's build system (qmake/cmake/etc.)
      if command -v qmake >/dev/null 2>&1; then
        qmake ../
        make -j$(nproc || sysctl -n hw.ncpu)
      elif [ -f ../CMakeLists.txt ]; then
        cmake .. -DCMAKE_BUILD_TYPE=Release
        cmake --build . --config Release -- -j$(nproc || sysctl -n hw.ncpu)
      else
        echo "No supported build tool (qmake/cmake) found; adjust the workflow to your project's build steps."
        exit 1
      fi
    shell: bash

  - name: Run tests (if any)
    run: |
      # run your test commands here, e.g. ctest or custom test scripts
      echo "No tests configured in workflow; add test steps if needed."
    shell: bash
